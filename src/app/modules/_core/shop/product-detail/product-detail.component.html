<div *ngIf="selectedProduct" [ngClass]="{'opacity-loading': loading}">

  <!-- loading component -->
  <app-loading *ngIf="loading"></app-loading>
  <!-- end loading component -->

  <!-- products detail-->
  <div nz-row nzGutter="0">

    <!-- product image-->
    <div nz-col class="gutter-row" nzXs="24" nzSm="24" nzMd="24" nzLg="12" nzXl="12">
      <img class="img-product-detail" src="{{ selectedProduct?.productImage }}" alt="{{ selectedProduct.productName }}">
    </div>
    <!-- end product image -->

    <!-- product information -->
    <div id="product-information" nz-col class="gutter-row" nzXs="24" nzSm="24" nzMd="24" nzLg="12" nzXl="12">
      <h1>{{ selectedProduct?.productName}}</h1>
      <h2>{{selectedProduct?.productPrice}}$</h2>

      <div class="share-buttons">
        <app-facebook-like></app-facebook-like>
        <app-twitter-share></app-twitter-share>
      </div>
      <p *ngIf="selectedProduct.productIncludeVat == 1" class="mg-top-12">
        incl. VAT, excl. shipping<br/>
        Delivery time: 2-7 days*
      </p>
      <div id="product-quantity">
        <nz-input-number style="z-index: 2;" [(ngModel)]="selectedProductQuantity" [nzMin]="1" [nzStep]="1"></nz-input-number>
      </div>
      <div class="buttons">
        <button style="z-index: 2;" nz-button nzType="primary" id="btn-add-to-cart" (click)="addProductToCart()"><i nz-icon nzType="shopping-cart"></i>
          Add to Cart
        </button>
      </div>
      <div id="product-description">
        <div class="line"></div>
        <p>
          {{ selectedProduct?.productMetaDescription }}
        </p>
        <div class="line"></div>
      </div>
    </div>
    <!-- end product information -->

    <!-- customer reviews -->
    <div nz-row nzGutter="0">
      <div id="customer-reviews" nz-col class="gutter-row" nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzXl="24">
        <h2 id="title-customer-reviews">Customer Reviews</h2>
        <button nz-button nzType="default" id="btn-write-reviews" (click)="toggleAddReviewForm()">Write Reviews</button>

        <div class="clear-both"></div>

        <!-- add reviews form -->
        <div id="add-reviews-form" *ngIf="isReviewFormShown">
          <nz-rate class="mg-top-24" [ngModel]="selectedProductRateValue" (ngModelChange)="onRateChanged($event)"></nz-rate>
          <br/>
          <textarea class="mg-top-24" id="reviews-text-area" rows="4" nz-input [(ngModel)]="reviewContent"
                    placeholder="Write Reviews..."></textarea> <br/>
          <button nz-button nzType="primary" id="btn-add-reviews" (click)="addProductReview()">Add Reviews</button>
        </div>
        <!-- end add reviews form -->

        <!-- pagination list -->

        <!-- reply comment template-->
        <ng-template #commentTemplateReplyRef let-comment="comment">
          <nz-comment [nzAuthor]="comment.userProfile.fullName"
                      [nzDatetime]="comment.replyOnProductFeedbackCreateDate | date: 'yyyy-MM-dd HH:mm:ss'">
            <nz-avatar nz-comment-avatar nzIcon="user" [nzSrc]="comment.userProfile.avatar"></nz-avatar>
            <nz-comment-content>
              <p>{{ comment.replyOnProductFeedbackContent }}</p>
            </nz-comment-content>
            <nz-comment-action>
              <i
                nz-tooltip
                nzTitle="Like"
                nz-icon
                type="like"
                [theme]="comment.isLikeClicked == true ? 'twotone' : 'outline'"
                (click)="likeReplyOnProductFeedback(comment)"
              ></i>
              <span class="count like">{{ comment?.nLikes }}</span>
            </nz-comment-action>
            <nz-comment-action>
              <i
                nz-tooltip
                nzTitle="Dislike"
                nz-icon
                type="dislike"
                [theme]="comment.isLikeClicked == false ? 'twotone' : 'outline'"
                (click)="dislikeReplyOnProductFeedback(comment)"
              ></i>
              <span class="count dislike">{{ comment?.nDislikes }}</span>
            </nz-comment-action>
            <nz-comment-action>
              <span (click)="showReplyReplyProductFeedbackBox(comment)">Reply to</span>
            </nz-comment-action>
          </nz-comment>
        </ng-template>
        <!-- end reply comment template -->

        <!-- comment template -->
        <ng-template #commentTemplateRef let-comment="comment">

          <!-- product's feedback content -->
          <nz-comment [nzAuthor]="comment.userProfile.fullName"
                      [nzDatetime]="comment.feedbackCreatedDate | date: 'yyyy-MM-dd HH:mm:ss'">
            <nz-avatar nz-comment-avatar nzIcon="user" [nzSrc]="comment.userProfile.avatar"></nz-avatar>
            <nz-comment-content>
              <p>{{ comment.feedbackContent }}</p>
            </nz-comment-content>
            <nz-comment-action>
              <i
                nz-tooltip
                nzTitle="Like"
                nz-icon
                type="like"
                [theme]="comment.isLikeClicked == true ? 'twotone' : 'outline'"
                (click)="like(comment)"
              ></i>
              <span class="count like">{{ comment?.nLikes }}</span>
            </nz-comment-action>
            <nz-comment-action>
              <i
                nz-tooltip
                nzTitle="Dislike"
                nz-icon
                type="dislike"
                [theme]="comment.isLikeClicked == false ? 'twotone' : 'outline'"
                (click)="dislike(comment)"
              ></i>
              <span class="count dislike">{{ comment?.nDislikes }}</span>
            </nz-comment-action>
            <nz-comment-action>
              <span (click)="showReplyProductFeedbackBox(comment)">Reply to</span>
            </nz-comment-action>
            <nz-comment-action>
              <span (click)="viewRepliesOfSelectedProductFeedback(comment)">View {{ comment?.nReplies }} replies</span>
            </nz-comment-action>
            <!-- end  product's feedback content -->

            <!-- relies of each product's feedback -->
            <ng-container *ngIf="comment.replies && comment.replies.length">
              <ng-template ngFor let-child [ngForOf]="comment.replies">
                <ng-template [ngTemplateOutlet]="commentTemplateReplyRef"
                             [ngTemplateOutletContext]="{ comment: child }">
                </ng-template>
              </ng-template>
            </ng-container>
            <!-- end relies of each product's feedback -->

            <!-- reply box-->
            <nz-input-group *ngIf="comment.isReplyBoxShown && comment.isReplyBoxShown == true"
                            [nzSuffix]="suffixIconMessage"
                            [ngClass]="{'mg-bottom-24': true, 'width-50': true}">
              <input type="text" nz-input placeholder="Reply..." #replyBox
                     (keyup.enter)="replyToProductFeedback(comment, replyBox.value); replyBox.value = ''"/>
            </nz-input-group>
            <ng-template #suffixIconMessage>
              <i nz-icon type="message"></i>
            </ng-template>
            <!-- end reply box -->

          </nz-comment>
        </ng-template>
        <!-- end comment template -->

        <div *ngFor="let eachProductFeedbackComment of productFeedbacksPerPage">
          <ng-template [ngTemplateOutlet]="commentTemplateRef"
                       [ngTemplateOutletContext]="{ comment: eachProductFeedbackComment }"></ng-template>
        </div>

        <!-- end pagination list -->

        <!-- pagination -->
        <nz-pagination
          *ngIf="isProductFeedbacksAndPaginationShown"
          [nzPageIndex]="currentPage"
          [nzPageSize]="nProductFeedbacksPerPage"
          [nzTotal]="totalProductFeedbacks"
          nzSize="small"
          (nzPageIndexChange)="productFeedbacksPageChange($event)"></nz-pagination>
        <!-- end pagination -->
      </div>

      <!-- end customer reviews -->

    </div>
  </div>
  <!-- end products detail-->
</div>
