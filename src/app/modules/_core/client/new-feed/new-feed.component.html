<!--suppress ALL -->
<div
  style="width: 100%; min-height: 280px; background-color: #fff; padding: 24px;"
  [ngClass]="{ 'opacity-loading': isLoadingSpinnerShown }"
>
  <!-- loading component -->
  <app-loading *ngIf="isLoadingSpinnerShown"></app-loading>
  <!-- end loading component -->

  <!-- search box-->
  <nz-input-group
    *ngIf="newFeeds && newFeeds.length"
    [nzSuffix]="suffixIconSearch"
    [ngClass]="{ 'mg-bottom-24': true, 'width-50': true }"
  >
    <input
      type="text"
      nz-input
      placeholder="Username..."
      #searchBox
      (keyup.enter)="searchNewFeed(searchBox.value)"
    />
  </nz-input-group>
  <ng-template #suffixIconSearch>
    <i nz-icon type="search"></i>
  </ng-template>
  <!-- end search box -->

  <!-- new feed content -->
  <div id="main-feed">
    <div class="feed-content" *ngFor="let eachNewFeed of newFeeds">
      <nz-card
        class="new-feed-card"
        [nzCover]="coverTemplate"
        [nzActions]="[actionSetting, actionEdit, actionEllipsis]"
      >
        <nz-card-meta
          nzTitle="{{ eachNewFeed?.userProfile.fullName }}"
          [nzDescription]="descriptionTemplate"
          [nzAvatar]="avatarTemplate"
        ></nz-card-meta>
      </nz-card>
      <ng-template #descriptionTemplate>
        <div class="description-achievement">
          {{ eachNewFeed.achievement }} -
          {{ eachNewFeed.achievementTime }} minutes
        </div>
        <span class="description-content">{{ eachNewFeed?.content }}</span>
      </ng-template>
      <ng-template #avatarTemplate>
        <nz-avatar nzSrc="{{ eachNewFeed?.userProfile.avatar }}"></nz-avatar>
      </ng-template>
      <ng-template #coverTemplate>
        <img alt="example" src="{{ eachNewFeed?.image }}" />
      </ng-template>
      <ng-template #actionSetting>
        <span class="status-value">{{ eachNewFeed.numberOfLikes }}</span>
        <i
          (click)="likeNewFeed(eachNewFeed)"
          [nzTheme]="eachNewFeed.isLikeClicked == true ? 'twotone' : 'outline'"
          nz-icon
          nzType="like"
        ></i>
      </ng-template>
      <ng-template #actionEdit>
        <span class="status-value">{{ eachNewFeed.numberOfDislikes }}</span>
        <i
          (click)="dislikeNewFeed(eachNewFeed)"
          [nzTheme]="eachNewFeed.isLikeClicked == false ? 'twotone' : 'outline'"
          nz-icon
          nzType="dislike"
        ></i>
      </ng-template>
      <ng-template #actionEllipsis>
        <span class="status-value">{{ eachNewFeed.numberOfComments }}</span>
        <i
          nz-icon
          nzType="message"
          (click)="viewNewFeedCommentsOfSelectedNewFeed(eachNewFeed)"
        ></i>
      </ng-template>

      <!-- reply new feed comment template-->
      <ng-template #commentTemplateReplyRef let-comment="comment">
        <nz-comment
          [nzAuthor]="comment.userProfile.fullName"
          [nzDatetime]="
            comment.replyOnNewFeedCommentCreatedDate
              | date: 'yyyy-MM-dd HH:mm:ss'
          "
        >
          <nz-avatar
            nz-comment-avatar
            nzIcon="user"
            [nzSrc]="comment.userProfile.avatar"
          ></nz-avatar>
          <nz-comment-content>
            <p>{{ comment.replyOnNewFeedCommentContent }}</p>
          </nz-comment-content>
          <nz-comment-action>
            <i
              nz-tooltip
              nzTitle="Like"
              nz-icon
              type="like"
              [theme]="comment.isLikeClicked == true ? 'twotone' : 'outline'"
              (click)="likeReplyOnNewFeedComment(comment)"
            ></i>
            <span class="count like">{{ comment?.numberOfLikes }}</span>
          </nz-comment-action>
          <nz-comment-action>
            <i
              nz-tooltip
              nzTitle="Dislike"
              nz-icon
              type="dislike"
              [theme]="comment.isLikeClicked == false ? 'twotone' : 'outline'"
              (click)="dislikeReplyOnNewFeedComment(comment)"
            ></i>
            <span class="count dislike">{{ comment?.numberOfDislikes }}</span>
          </nz-comment-action>
          <nz-comment-action>
            <span (click)="showReplyRelyNewFeedCommentBox(comment)"
              >Reply to</span
            >
          </nz-comment-action>
        </nz-comment>
      </ng-template>
      <!-- end reply new feed comment template -->

      <!-- comment template -->
      <ng-template #commentTemplateRef let-comment="comment">
        <!-- new feed comment content -->
        <nz-comment
          [nzAuthor]="comment.userProfile.fullName"
          [nzDatetime]="
            comment.newFeedCommentCreatedDate | date: 'yyyy-MM-dd HH:mm:ss'
          "
        >
          <nz-avatar
            nz-comment-avatar
            nzIcon="user"
            [nzSrc]="comment.userProfile.avatar"
          ></nz-avatar>
          <nz-comment-content>
            <p>{{ comment.newFeedCommentContent }}</p>
          </nz-comment-content>
          <nz-comment-action>
            <i
              nz-tooltip
              nzTitle="Like"
              nz-icon
              type="like"
              [theme]="comment.isLikeClicked == true ? 'twotone' : 'outline'"
              (click)="likeNewFeedComment(comment)"
            ></i>
            <span class="count like">{{ comment?.numberOfLikes }}</span>
          </nz-comment-action>
          <nz-comment-action>
            <i
              nz-tooltip
              nzTitle="Dislike"
              nz-icon
              type="dislike"
              [theme]="comment.isLikeClicked == false ? 'twotone' : 'outline'"
              (click)="dislikeNewFeedComment(comment)"
            ></i>
            <span class="count dislike">{{ comment?.numberOfDislikes }}</span>
          </nz-comment-action>
          <nz-comment-action>
            <span (click)="showReplyNewFeedCommentBox(comment)">Reply to</span>
          </nz-comment-action>
          <nz-comment-action>
            <span (click)="viewRepliesOfSelectedNewFeedComment(comment)"
              >View {{ comment?.numberOfReplies }} replies</span
            >
          </nz-comment-action>
          <!-- end  new feed comment content -->

          <!-- relies of each new feed comment -->
          <ng-container *ngIf="comment.replies && comment.replies.length">
            <ng-template ngFor let-child [ngForOf]="comment.replies">
              <ng-template
                [ngTemplateOutlet]="commentTemplateReplyRef"
                [ngTemplateOutletContext]="{ comment: child }"
              >
              </ng-template>
            </ng-template>
          </ng-container>
          <!-- end relies of each new feed comment -->

          <!-- reply box-->
          <nz-input-group
            *ngIf="comment.isReplyBoxShown && comment.isReplyBoxShown == true"
            [nzSuffix]="suffixIconMessage"
            [ngClass]="{ 'mg-bottom-24': true }"
            style="width: 100%;"
          >
            <input
              type="text"
              nz-input
              placeholder="Reply..."
              #replyBox
              (keyup.enter)="
                replyToNewFeedComment(comment, replyBox.value);
                replyBox.value = ''
              "
            />
          </nz-input-group>
          <ng-template #suffixIconMessage>
            <i nz-icon type="message"></i>
          </ng-template>
          <!-- end reply box -->
        </nz-comment>
      </ng-template>
      <!-- end comment template -->

      <div *ngIf="eachNewFeed.replies && eachNewFeed.replies.length">
        <div *ngFor="let eachNewFeedComment of eachNewFeed.replies">
          <ng-template
            [ngTemplateOutlet]="commentTemplateRef"
            [ngTemplateOutletContext]="{ comment: eachNewFeedComment }"
          ></ng-template>
        </div>
      </div>

      <!-- add new feed comment box-->
      <nz-input-group
        *ngIf="
          eachNewFeed.isReplyBoxShown && eachNewFeed.isReplyBoxShown == true
        "
        [nzSuffix]="suffixIconMessage"
        [ngClass]="{ 'mg-bottom-24': true }"
        style="width: 100%;"
      >
        <input
          type="text"
          nz-input
          placeholder="Write your comment..."
          #replyBox
          (keyup.enter)="
            addNewFeedComment(eachNewFeed, replyBox.value); replyBox.value = ''
          "
        />
      </nz-input-group>
      <ng-template #suffixIconMessage>
        <i nz-icon type="message"></i>
      </ng-template>
      <!-- end add new feed comment box -->
    </div>
  </div>
  <!-- end new feed content -->

  <!-- pagination -->
  <div id="pagination">
    <nz-pagination
      *ngIf="newFeeds && newFeeds.length"
      [nzPageIndex]="currentNewFeedsPage"
      [nzPageSize]="nNewFeedsPerPage"
      [nzTotal]="totalNewFeeds"
      [nzSize]="'small'"
      (nzPageIndexChange)="newFeedPageChange($event)"
    ></nz-pagination>
  </div>
  <!-- end pagination -->
</div>
